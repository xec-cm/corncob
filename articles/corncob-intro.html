<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="corncob">
<title>Introduction to corncob • corncob</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to corncob">
<meta property="og:description" content="corncob">
<meta property="og:image" content="https://statdivlab.github.io/corncob/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">corncob</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/corncob-intro.html">Introduction to corncob</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/statdivlab/corncob/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to corncob</h1>
                        <h4 data-toc-skip class="author">Bryan D
Martin</h4>
            
            <h4 data-toc-skip class="date">2023-11-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/statdivlab/corncob/blob/HEAD/vignettes/corncob-intro.Rmd" class="external-link"><code>vignettes/corncob-intro.Rmd</code></a></small>
      <div class="d-none name"><code>corncob-intro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="vignette-information">Vignette Information<a class="anchor" aria-label="anchor" href="#vignette-information"></a>
</h2>
<p>We thank Dr. Thea Whitman for kindly providing us with the example
data set we use for this vignette. You can read more about this data in
Whitman, Thea, et al. “Dynamics of microbial community composition and
soil organic carbon mineralization in soil following addition of
pyrogenic and fresh organic matter.” 10.12 (2016): 2918.</p>
<p>We also use IBD microbiome data from Papa, Eliseo, et
al. “Non-Invasive Mapping of the Gastrointestinal Microbiota Identifies
Children with Inflammatory Bowel Disease.” 7(6), e39242. The data are
made available by Duvallet, Claire, et al. (2017). “MicrobiomeHD: the
human gut microbiome in health and disease” [Data set]. Zenodo. We thank
the authors for making their data open source and easily accessible.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
Effectively modeling microbial relative abundance poses a number of
statistical challenges, including:
<p>Here, we introduce , an individual taxon regression model that uses
abundance tables and sample data. is able to model differential
abundance and differential variability, and addresses each of the
challenges presented above.</p>
<p>Note that in order to follow along with this tutorial (but not to use
!) you will need to have installed.</p>
<p>Install using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"statdivlab/corncob"</span><span class="op">)</span></span></code></pre></div>
<p>To begin, we load our example data set as a object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statdivlab/corncob" class="external-link">corncob</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217" class="external-link">phyloseq</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">soil_phylo</span><span class="op">)</span></span></code></pre></div>
<p>If you are unfamiliar with , we can view a description of the data
using:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soil_phylo</span></span></code></pre></div>
<pre><code><span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 7770 taxa and 119 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 119 samples by 5 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 7770 taxa by 7 taxonomic ranks ]</span></span></code></pre>
<p>We now see that we have an OTU abundance table with 7770 OTUs and 119
samples. We can extract using . Let’s examine a small subset of our data
in more detail.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html" class="external-link">otu_table</a></span><span class="op">(</span><span class="va">soil_phylo</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## OTU Table:          [3 taxa and 3 samples]</span></span>
<span><span class="co">##                      taxa are rows</span></span>
<span><span class="co">##         S009 S204 S112</span></span>
<span><span class="co">## OTU.43   350   74  300</span></span>
<span><span class="co">## OTU.2   1796 4204 1752</span></span>
<span><span class="co">## OTU.187  280  709  426</span></span></code></pre>
<p>We can also see that we have 5 sample variables. We can extract this
using . Let’s again examine a small subset in more detail.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html" class="external-link">sample_data</a></span><span class="op">(</span><span class="va">soil_phylo</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##      Plants DayAmdmt Amdmt ID Day</span></span>
<span><span class="co">## S009      1       01     1  D   0</span></span>
<span><span class="co">## S204      1       21     1  D   2</span></span>
<span><span class="co">## S112      0       11     1  B   1</span></span></code></pre>
Our covariates are as follows:
<p>Finally, we have a taxonomy table with 7 taxonomic ranks.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html" class="external-link">tax_table</a></span><span class="op">(</span><span class="va">soil_phylo</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Taxonomy Table:     [3 taxa by 7 taxonomic ranks]:</span></span>
<span><span class="co">##         Kingdom    Phylum           Class                 Order             </span></span>
<span><span class="co">## OTU.43  "Bacteria" "Nitrospirae"    "Nitrospira"          "Nitrospirales"   </span></span>
<span><span class="co">## OTU.2   "Bacteria" "Proteobacteria" "Alphaproteobacteria" "Rhizobiales"     </span></span>
<span><span class="co">## OTU.187 "Bacteria" "Acidobacteria"  "Acidobacteriia"      "Acidobacteriales"</span></span>
<span><span class="co">##         Family              Genus            Species</span></span>
<span><span class="co">## OTU.43  "Nitrospiraceae"    "Nitrospira"     ""     </span></span>
<span><span class="co">## OTU.2   "Bradyrhizobiaceae" "Bradyrhizobium" ""     </span></span>
<span><span class="co">## OTU.187 "Koribacteraceae"   ""               ""</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="fitting-a-model">Fitting a Model<a class="anchor" aria-label="anchor" href="#fitting-a-model"></a>
</h2>
<p>Now, let’s set up our model.</p>
<p>First, let’s subset our samples to only include those with the
covariate equal to 11 or 21 and then collapse the samples to the phylum
level. The code to generate this data from is commented out.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># soil &lt;- soil_phylo %&gt;% </span></span>
<span><span class="co">#             phyloseq::subset_samples(DayAmdmt %in% c(11,21)) %&gt;%</span></span>
<span><span class="co">#             tax_glom("Phylum") </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">soil_phylum_small</span><span class="op">)</span></span>
<span><span class="va">soil</span> <span class="op">&lt;-</span> <span class="va">soil_phylum_small</span></span></code></pre></div>
<p>Let’s examine the data and the taxonomy table again.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soil</span></span></code></pre></div>
<pre><code><span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 39 taxa and 32 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 32 samples by 5 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 39 taxa by 7 taxonomic ranks ]</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html" class="external-link">tax_table</a></span><span class="op">(</span><span class="va">soil</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Taxonomy Table:     [5 taxa by 7 taxonomic ranks]:</span></span>
<span><span class="co">##         Kingdom    Phylum             Class Order Family Genus Species</span></span>
<span><span class="co">## OTU.19  "Bacteria" "Acidobacteria"    NA    NA    NA     NA    NA     </span></span>
<span><span class="co">## OTU.1   "Bacteria" "Proteobacteria"   NA    NA    NA     NA    NA     </span></span>
<span><span class="co">## OTU.15  "Bacteria" "Gemmatimonadetes" NA    NA    NA     NA    NA     </span></span>
<span><span class="co">## OTU.3   "Bacteria" "Actinobacteria"   NA    NA    NA     NA    NA     </span></span>
<span><span class="co">## OTU.133 "Bacteria" "[Thermi]"         NA    NA    NA     NA    NA</span></span></code></pre>
<p>Note that collapsing the samples is not necessary, and this model can
work at any taxonomic rank. However, we will later be fitting a model to
every taxa. We can see that by agglomerating taxa to the phylum level,
we have gone from from 7770 to 40 taxa. Thus we collapse in order to
increase the speed for the purposes of this tutorial.</p>
<p>Now we fit our model. We will demonstrate with Proteobacteria, or
OTU.1.</p>
<p>For now, we will not include any covariates, so we use as our model
formula responses.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corncob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbdml.html">bbdml</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">OTU.1</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>             phi.formula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>             data <span class="op">=</span> <span class="va">soil</span><span class="op">)</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
<div class="section level2">
<h2 id="interpreting-a-model">Interpreting a Model<a class="anchor" aria-label="anchor" href="#interpreting-a-model"></a>
</h2>
<p>First, let’s plot the data with our model fit on the relative
abundance scale. To do this, we simply type:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corncob</span>, B <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-12-1.png" width="768"></p>
<p>The points represent the relative abundances. The bars represent the
95% prediction intervals for the observed relative abundance by sample.
The parameter <code>B</code> determines the number of bootstrap
simulations used to approximate the prediction intervals. For purposes
of this tutorial, we use a small value <code>B = 50</code> for
computational purposes, but recommend a higher setting for more accurate
intervals, such as the default <code>B = 1000</code>.</p>
<p>Now let’s look at the same plot, but on the counts scale with 95%
prediction intervals (since counts is not a parameter). To do this, we
add the option to our plotting code.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corncob</span>, total <span class="op">=</span> <span class="cn">TRUE</span>, B <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
<p>Finally, let’s color the plot by the covariate. To do this, we add
the option to our plotting code.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corncob</span>, total <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"DayAmdmt"</span>, B <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-14-1.png" width="768"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corncob</span>, color <span class="op">=</span> <span class="st">"DayAmdmt"</span>, B <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-15-1.png" width="768"></p>
<p>Notice that this plot also reorders our samples so that groups appear
together so that they are easier to compare.</p>
<p>We can observe on this plot that it might be of interest to
distinguish between the two groups with covariates. The average
empirical relative abundance for the samples with tends to be lower and
less variable than the samples with .</p>
</div>
<div class="section level2">
<h2 id="adding-covariates">Adding covariates<a class="anchor" aria-label="anchor" href="#adding-covariates"></a>
</h2>
<p>Let’s try modeling the expected relative abundance and the
variability of the counts with as a covariate. We do this by modifying
and as:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corncob_da</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbdml.html">bbdml</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">OTU.1</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>             phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>             data <span class="op">=</span> <span class="va">soil</span><span class="op">)</span></span></code></pre></div>
<p>Let’s also plot this data on both the total count and relative
abundance scales.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corncob_da</span>, color <span class="op">=</span> <span class="st">"DayAmdmt"</span>, total <span class="op">=</span> <span class="cn">TRUE</span>, B <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-17-1.png" width="768"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corncob_da</span>, color <span class="op">=</span> <span class="st">"DayAmdmt"</span>, B <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-18-1.png" width="768"></p>
<p>Visually, the model with covariates seems to provide a much better
fit to the data, but how can we compare the two models
statistically?</p>
</div>
<div class="section level2">
<h2 id="model-selection">Model Selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h2>
<p>Let’s use a likelihood ratio test to select our final model for this
taxon. We want to test the null hypothesis that the likelihood of the
model with covariates is equal to the likelihood of the model without
covariates. To do this test, we use:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lrtest.html">lrtest</a></span><span class="op">(</span>mod_null <span class="op">=</span> <span class="va">corncob</span>, mod <span class="op">=</span> <span class="va">corncob_da</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4.550571e-05</span></span></code></pre>
<p>We obtain a p-value much smaller than a cut-off of 0.05. Therefore we
conclude that there is a statistically significant difference in the
likelihood of the two models. Thus, we probably want to use the model
with covariates for this taxon.</p>
</div>
<div class="section level2">
<h2 id="parameter-interpretation">Parameter Interpretation<a class="anchor" aria-label="anchor" href="#parameter-interpretation"></a>
</h2>
<p>Now that we have chosen our model, let’s interpret our model output.
To see a summary of the model, type:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">corncob_da</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## bbdml(formula = OTU.1 ~ DayAmdmt, phi.formula = ~DayAmdmt, data = soil)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients associated with abundance:</span></span>
<span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept) -0.44595    0.03604 -12.375 7.18e-13 ***</span></span>
<span><span class="co">## DayAmdmt21  -0.16791    0.04067  -4.129 0.000297 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients associated with dispersion:</span></span>
<span><span class="co">##             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)  -5.3077     0.3537 -15.008 6.44e-15 ***</span></span>
<span><span class="co">## DayAmdmt21   -1.3518     0.5029  -2.688    0.012 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Log-likelihood: -286.53</span></span></code></pre>
<p>This output will look familiar if you have done regression analysis
in R in the past. Covariates associated with the expected relative
abundance are presented separately from covariates associated with the
variance of the counts are preceded by.</p>
<p>From this model summary, we can see that the abundance coefficient is
negative and statistically significant. This suggests that this taxon is
differentially-abundant across , and that samples with are expected to
have a lower relative abundance. This matches what we saw from the
observed abundances.</p>
<p>We can also see that the dispersion coefficient is negative and
statistically significant. This suggests that this taxon is
differentially-variable across , and that samples with are expected to
have a lower variability. This matches what we saw from the observed
abundances.</p>
</div>
<div class="section level2">
<h2 id="analysis-for-multiple-taxa">Analysis for Multiple Taxa<a class="anchor" aria-label="anchor" href="#analysis-for-multiple-taxa"></a>
</h2>
<p>What if we want to test all the taxa in our data to see if they are
differentially-abundant or differentially-variable? We use the function.
It will perform the above tests on all taxa, and it will control the
false discovery rate to account for multiple comparisons.</p>
<p>Next, we use the command. We specify the covariates of our model
using and as before, except we no longer include the response term
because we are testing multiple taxa. We also specify which covariates
we want to test for by removing them in the and arguments.</p>
<p>The difference between the formulas and the null version of the
formulas are the variables that we test. We will go through several
examples, starting with a test for differential abundance across the
coefficient.</p>
<p>We set to be our controlled false discovery rate.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">da_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">soil</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p>We can see the output of the function by calling it:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da_analysis</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class differentialTest </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $p: p-values </span></span>
<span><span class="co">## $p_fdr: FDR-adjusted p-values </span></span>
<span><span class="co">## $significant_taxa: taxa names of the statistically significant taxa </span></span>
<span><span class="co">## $significant_models: model summaries of the statistically significant taxa </span></span>
<span><span class="co">## $all_models: all model summaries </span></span>
<span><span class="co">## $restrictions_DA: covariates tested for differential abundance </span></span>
<span><span class="co">## $restrictions_DV: covariates tested for differential variability </span></span>
<span><span class="co">## $discriminant_taxa_DA: taxa for which at least one covariate associated with the abundance was perfectly discriminant </span></span>
<span><span class="co">## $discriminant_taxa_DV: taxa for which at least one covariate associated with the dispersion was perfectly discriminant </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## plot( ) to see a plot of tested coefficients from significant taxa</span></span></code></pre>
<p>We can see a list of differentially-abundant taxa using:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da_analysis</span><span class="op">$</span><span class="va">significant_taxa</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "OTU.1"    "OTU.15"   "OTU.8"    "OTU.69"   "OTU.6"    "OTU.59"  </span></span>
<span><span class="co">##  [7] "OTU.695"  "OTU.628"  "OTU.703"  "OTU.908"  "OTU.1570" "OTU.417" </span></span>
<span><span class="co">## [13] "OTU.584"  "OTU.1672"</span></span></code></pre>
<p>In this case, we identified 14 taxa that are differentially-abundant
across (out of the 39 taxa tested).</p>
<p>We can see a list of differentially-variable taxa using:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">dv_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">soil</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"LRT"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">dv_analysis</span><span class="op">$</span><span class="va">significant_taxa</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "OTU.19"  "OTU.69"  "OTU.628" "OTU.703" "OTU.417"</span></span></code></pre>
<p>We can switch the OTU labels to taxonomic labels using . We supply
our OTU labels as strings for the argument. We supply the object for the
argument.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/otu_to_taxonomy.html">otu_to_taxonomy</a></span><span class="op">(</span>OTU <span class="op">=</span> <span class="va">da_analysis</span><span class="op">$</span><span class="va">significant_taxa</span>, data <span class="op">=</span> <span class="va">soil</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                       OTU.1                      OTU.15 </span></span>
<span><span class="co">##   "Bacteria_Proteobacteria" "Bacteria_Gemmatimonadetes" </span></span>
<span><span class="co">##                       OTU.8                      OTU.69 </span></span>
<span><span class="co">##    "Bacteria_Bacteroidetes"    "Bacteria_Cyanobacteria" </span></span>
<span><span class="co">##                       OTU.6                      OTU.59 </span></span>
<span><span class="co">##       "Bacteria_Firmicutes"   "Bacteria_Planctomycetes" </span></span>
<span><span class="co">##                     OTU.695                     OTU.628 </span></span>
<span><span class="co">##  "Bacteria_Armatimonadetes"     "Bacteria_Spirochaetes" </span></span>
<span><span class="co">##                     OTU.703                     OTU.908 </span></span>
<span><span class="co">##    "Bacteria_Elusimicrobia"             "Bacteria_BRC1" </span></span>
<span><span class="co">##                    OTU.1570                     OTU.417 </span></span>
<span><span class="co">##              "Bacteria_OP3"              "Bacteria_FBP" </span></span>
<span><span class="co">##                     OTU.584                    OTU.1672 </span></span>
<span><span class="co">##         "Bacteria_Chlorobi"              "Bacteria_TM6"</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/otu_to_taxonomy.html">otu_to_taxonomy</a></span><span class="op">(</span>OTU <span class="op">=</span> <span class="va">dv_analysis</span><span class="op">$</span><span class="va">significant_taxa</span>, data <span class="op">=</span> <span class="va">soil</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   OTU.19                   OTU.69                  OTU.628 </span></span>
<span><span class="co">## "Bacteria_Acidobacteria" "Bacteria_Cyanobacteria"  "Bacteria_Spirochaetes" </span></span>
<span><span class="co">##                  OTU.703                  OTU.417 </span></span>
<span><span class="co">## "Bacteria_Elusimicrobia"           "Bacteria_FBP"</span></span></code></pre>
<p>In this case, we identified 5 taxa that are differentially-variable
across (out of the 40 taxa tested).</p>
<p>We can examine a subset of the p-values of our tests using:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da_analysis</span><span class="op">$</span><span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##       OTU.19        OTU.1       OTU.15        OTU.3      OTU.133 </span></span>
<span><span class="co">## 6.509417e-01 3.642734e-05 3.270448e-13 3.703096e-01 1.031419e-01</span></span></code></pre>
<p>We can examine a subset of the p-values after controlling for the
false discovery rate using:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da_analysis</span><span class="op">$</span><span class="va">p_fdr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##       OTU.19        OTU.1       OTU.15        OTU.3      OTU.133 </span></span>
<span><span class="co">## 7.811301e-01 1.457094e-04 3.924537e-12 5.172748e-01 2.062838e-01</span></span></code></pre>
<p>where the values are now adjusted to control the false discovery rate
at 0.05.</p>
<p>We can also plot the model coefficients of our results:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">da_analysis</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-29-1.png" width="768"></p>
<p>Here, we can see that for Bacteria_Armatimonadetes, the effect of
DayAmdmt21 is positive compared to the baseline (in this case,
DayAmdmt11).</p>
<p>Finally, we can see a list of any taxa for which we were not able to
fit a model using:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">da_analysis</span><span class="op">$</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">names</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "OTU.4206" "OTU.8773" "OTU.8219"</span></span></code></pre>
<p>In this case, we weren’t able to fit automatically. It’s worthwhile
to investigate the OTU individually if this is the case. First let’s
check what phylum this represents.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/otu_to_taxonomy.html">otu_to_taxonomy</a></span><span class="op">(</span>OTU <span class="op">=</span> <span class="st">"OTU.4206"</span>, data <span class="op">=</span> <span class="va">soil</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        OTU.4206 </span></span>
<span><span class="co">## "Bacteria_GN04"</span></span></code></pre>
<p>It may be that the model is overparameterized because there aren’t
enough observations, or it may just be that the initializations were
invalid for that taxa and it needs to be re-evaluated with new
initializations.</p>
<p>Let’s first try examining the data.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html" class="external-link">otu_table</a></span><span class="op">(</span><span class="va">soil</span><span class="op">)</span><span class="op">[</span><span class="st">"OTU.4206"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## OTU Table:          [1 taxa and 32 samples]</span></span>
<span><span class="co">##                      taxa are rows</span></span>
<span><span class="co">##          S204 S112 S134 S207 S202 S139 S122 S212 S117 S104 S214 S109 S217 S229</span></span>
<span><span class="co">## OTU.4206    0    0    0    0    0    0    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">##          S132 S209 S227 S107 S237 S224 S127 S137 S114 S124 S119 S219 S232 S129</span></span>
<span><span class="co">## OTU.4206    0    0    0    0    0    0    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">##          S102 S234 S222 S239</span></span>
<span><span class="co">## OTU.4206    1    0    0    0</span></span></code></pre>
<p>We see that the observed counts of OTU is zero in all samples except
for }, where we observed a single count. Let’s try fitting the model
individually by letting the model select the initializations
automatically.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_GN04</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbdml.html">bbdml</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">OTU.4206</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">DayAmdmt</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">soil</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Separation detected in abundance model!</span></span>
<span><span class="co">## Likely, one of your covariates/experimental conditions is such that</span></span>
<span><span class="co">## there are all zero counts within a group. The results of this model should</span></span>
<span><span class="co">## be interpreted with care because there is insufficient data to distinguish between groups.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Separation detected in dispersion model!</span></span>
<span><span class="co">## Likely, one of your covariates/experimental conditions is such that</span></span>
<span><span class="co">## there are all zero counts within a group. The results of this model should</span></span>
<span><span class="co">## be interpreted with care because there is insufficient data to distinguish between groups.</span></span></code></pre>
<p>While the model fits, we should be skeptical of <strong>any</strong>
statistical model fit on a single observed count!</p>
<p> is stable, but new. If you notice any issues, please <a href="https://github.com/statdivlab/corncob/issues" class="external-link">log them on
Github</a> to help us help you!</p>
</div>
<div class="section level2">
<h2 id="examples-of-answering-scientific-questions">Examples of Answering Scientific Questions<a class="anchor" aria-label="anchor" href="#examples-of-answering-scientific-questions"></a>
</h2>
<p>We will now walk through several scientific questions of interest and
show how they can be answered using hypothesis testing with . Note that
Day and Amdmt are both factor covariates with levels 0, 1, and 2.</p>
<p>Note that some of these are rather strange tests, and shown for
demonstration of the flexibility of the model only. Normally, when
testing for differential variability across a covariate, we recommend
always controlling for the effect of that covariate on the abundance. We
first demonstrate examples with the soil dataset.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soil_full</span> <span class="op">&lt;-</span> <span class="va">soil_phylo</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_glom.html" class="external-link">tax_glom</a></span><span class="op">(</span><span class="st">"Phylum"</span><span class="op">)</span> </span></code></pre></div>
<p>Testing for differential abundance across Day, without controlling
for anything else:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">soil_full</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex1</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-35-1.png" width="768"></p>
<p>Testing for differential abundance across Day, controlling for the
effect of Day on dispersion:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">soil_full</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex2</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-36-1.png" width="768"></p>
<p>Jointly testing for differential abundance and differential
variability across Day:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">soil_full</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex3</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-37-1.png" width="768"></p>
<p>Jointly testing for differential abundance and differential
variability across Day, controlling for the effect of Amdmt on abundance
only:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span> <span class="op">+</span> <span class="va">Amdmt</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="va">Amdmt</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">soil_full</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex4</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-38-1.png" width="768"></p>
<p>Jointly testing for differential abundance across Day and
differential abundance across Amdmt, controlling for the effect of Day
and Amdmt on dispersion:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span> <span class="op">+</span> <span class="va">Amdmt</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span> <span class="op">+</span> <span class="va">Amdmt</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span> <span class="op">+</span> <span class="va">Amdmt</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">soil_full</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex5</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-39-1.png" width="768"></p>
<p>Jointly testing for differential abundance across Day, and
differential dispersion across Amdmt, controlling for the effect of Day
on Dispersion:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span> <span class="op">+</span> <span class="va">Amdmt</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="va">Day</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">soil_full</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex6</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-40-1.png" width="768"></p>
<p>We now demonstrate examples with the IBD data set. We again begin by
agglomerating for purposes of demonstration. We agglomerate to the genus
level.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ibd_phylo</span><span class="op">)</span></span>
<span><span class="va">ibd</span> <span class="op">&lt;-</span> <span class="va">ibd_phylo</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_glom.html" class="external-link">tax_glom</a></span><span class="op">(</span><span class="st">"Genus"</span><span class="op">)</span> </span></code></pre></div>
<p>Testing for differential abundance across IBD status, without
controlling for anything else:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">ibd</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">ibd</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex7</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-42-1.png" width="768"></p>
<p>We can make the plot cleaner using the parameter. Here we will
display both the family and genus information.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex7</span>, level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Family"</span>, <span class="st">"Genus"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-43-1.png" width="768"></p>
<p>Jointly testing for differential abundance and differential
variability across IBD status, without controlling for anything
else:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/differentialTest.html">differentialTest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">ibd</span>,</span>
<span>                                 phi.formula <span class="op">=</span> <span class="op">~</span> <span class="va">ibd</span>,</span>
<span>                                 formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 phi.formula_null <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                 data <span class="op">=</span> <span class="va">ibd</span>,</span>
<span>                                 test <span class="op">=</span> <span class="st">"Wald"</span>, boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 fdr_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex8</span>, level <span class="op">=</span> <span class="st">"Genus"</span><span class="op">)</span></span></code></pre></div>
<p><img src="corncob-intro_files/figure-html/unnamed-chunk-44-1.png" width="768"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bryan D Martin, Daniela Witten, Amy D Willis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
